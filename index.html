<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link rel="stylesheet" href="main.css" type="text/css" media="screen" />
</head>
<body>
<div id="column-content">
	<div id="content">
		<a name="top" id="top"></a>
				<h1 id="firstHeading" class="firstHeading">Main Page</h1>
		<div id="bodyContent">
			<h3 id="siteSub">From mochad</h3>
			<div id="contentSub"></div>
									<div id="jump-to-nav">Jump to: <a href="#column-one">navigation</a>, <a href="#searchInput">search</a></div>			<!-- start content -->
			<p><big> mochad, Multiple Online Controllers for Home Automation Daemon </big>
</p><p>mochad is a Linux TCP gateway daemon for the X10 CM15A RF (radio frequency) and
PL (power line) controller and the CM19A RF controller. 
</p><p>mochad stands for Multiple Online Controllers for Home Automation Daemon.
</p>
<table id="toc" class="toc" summary="Contents"><tbody><tr><td><div id="toctitle"><h2>Contents</h2> <span class="toctoggle">[<a id="togglelink" class="internal" href="javascript:toggleToc()">hide</a>]</span></div>
<ul>
<li class="toclevel-1"><a href="#Build_it"><span class="tocnumber">1</span> <span class="toctext">Build it</span></a></li>
<li class="toclevel-1"><a href="#Run_it"><span class="tocnumber">2</span> <span class="toctext">Run it</span></a></li>
<li class="toclevel-1"><a href="#Use_it"><span class="tocnumber">3</span> <span class="toctext">Use it</span></a></li>
<li class="toclevel-1"><a href="#Multiple_controllers"><span class="tocnumber">4</span> <span class="toctext">Multiple controllers</span></a></li>
<li class="toclevel-1"><a href="#Command_line_X10_control"><span class="tocnumber">5</span> <span class="toctext">Command line X10 control</span></a></li>
<li class="toclevel-1"><a href="#Application_examples"><span class="tocnumber">6</span> <span class="toctext">Application examples</span></a></li>
<li class="toclevel-1"><a href="#Web_Interface"><span class="tocnumber">7</span> <span class="toctext">Web Interface</span></a></li>
<li class="toclevel-1"><a href="#Hardware"><span class="tocnumber">8</span> <span class="toctext">Hardware</span></a></li>
<li class="toclevel-1"><a href="#Files"><span class="tocnumber">9</span> <span class="toctext">Files</span></a></li>
<li class="toclevel-1"><a href="#X10_Protocol"><span class="tocnumber">10</span> <span class="toctext">X10 Protocol</span></a></li>
<li class="toclevel-1"><a href="#Acknowledgments"><span class="tocnumber">11</span> <span class="toctext">Acknowledgments</span></a></li>
<li class="toclevel-1"><a href="#References"><span class="tocnumber">12</span> <span class="toctext">References</span></a></li>
</ul>
</td></tr></tbody></table><script type="text/javascript"> if (window.showTocToggle) { var tocShowText = "show"; var tocHideText = "hide"; showTocToggle(); } </script>
<a name="Build_it" id="Build_it"></a><h2> <span class="mw-headline"> Build it </span></h2>
<p>mochad compiles and runs on Ubuntu 10.04 and 10.10. It probably works on older
versions but has not been tested. See <a href="openwrt.html" title="OpenWrt">OpenWrt</a> for details on building and
running on an <a href="http://openwrg.org/" class="external text" title="http://openwrg.org" rel="nofollow">OpenWrt</a> platform.
</p><p>The libusb-1.0 development files are required. To install,
</p>
<pre>   sudo apt-get install libusb-1.0-0-dev
</pre>
<p>The usual pattern for building the code applies.
</p>
<pre>   tar xzf mochad-...tar.gz
   cd mochad-...
   ./configure
   make
   sudo make install
</pre>
<a name="Run_it" id="Run_it"></a><h2> <span class="mw-headline"> Run it </span></h2>
<p>Plugging a CM15A or CM19A should launch mochad. There no need to run mochad
by hand or run it from /etc/rc.local. mochad is launched by a udev rule that
matches the CM15A and CM19A USB vendor and product ID codes.
</p><p>To run manually, run mochad as root (that is, sudo ./mochad). mochad will
detach from the terminal and continue to run in the background. See 
/var/log/messages for error and status messages. mochad will exit if it cannot
find a supported controller.
</p><p>The only command line option so far is -d which will cause mochad to run in the
foreground and produce debug output.
</p>
<a name="Use_it" id="Use_it"></a><h2> <span class="mw-headline"> Use it </span></h2>
<p>Connect to mochad using netcat. For example, 
</p>
<pre>   nc localhost 1099
</pre>
<p>You can connect to mochad from another host by specifying the IP of the host
running mochad. netcat is available for Windows at
&lt;<a href="http://joncraton.org/blog/netcat-for-windows" class="external free" title="http://joncraton.org/blog/netcat-for-windows" rel="nofollow">http://joncraton.org/blog/netcat-for-windows</a>&gt;.
</p><p>For a complete list of commands and event messages, please see <a href="mochad_reference.html" title="Mochad Reference">mochad Reference</a>.
</p><p>Everything sent by mochad appears on netcat standard output. In the simplest
use case, mochad/netcat can be used to see X10 PL and RF activity. For example,
run mochad on one host with a CM15A then connect to it using netcat from a
netbook. Walk around with various X10 RF remote controls and the netbook to see
which remotes work from various locations.
</p><p>Sample output:
</p>
<pre>   12/07 20:49:10 Rx RF HouseUnit: C3 Func: Off
   12/07 20:49:10 Tx PL HouseUnit: C3
   12/07 20:49:10 Tx PL House: C Func: Off
   12/07 20:49:10 Rx RF HouseUnit: C3 Func: Off
   12/07 20:49:10 Tx PL HouseUnit: C3
   12/07 20:49:10 Tx PL House: C Func: Off
   12/07 20:49:17 Rx RFSEC Addr: 0x11 Func: Lights_Off_SH624
   12/07 20:49:17 Rx RFSEC Addr: 0x11 Func: Lights_Off_SH624
   12/07 20:49:37 Rx RFSEC Addr: C6:1B:00 Func: Motion_alert_MS10A
   12/07 20:49:37 Rx RFSEC Addr: C6:1B:00 Func: Motion_alert_MS10A
   12/07 20:49:37 Rx RFSEC Addr: C6:1B:00 Func: Motion_alert_MS10A
   12/07 20:49:37 Rx RFSEC Addr: C6:1B:00 Func: Motion_alert_MS10A
</pre>
<p>Everything sent to netcat standard input is sent to mochad. The following is a
brief list of mochad commands.
</p>
<pre>   pl a1 [on|off]
   pl a1 [dim|bright] 0..31
   pl a1 xdim 0..255
</pre>
<pre>   pl a1
   pl a2
   pl a [on|off|dim|bright|xdim|all_lights_on|all_lights_off|all_units_off]
</pre>
<pre>   rf a1 [on|off|dim|bright]
</pre>
<pre>   st  -- show device status including RF security devices
</pre>
<p>By default, received RF X10 commands are repeated on the PL interface for all
house codes. This can be changed using the rftopl command (RF to PL repeater).
</p>
<pre>   rftopl *    -- enable all house codes (default)
   rftopl abc  -- enable for house codes A, B, and C. Disable for all others.
   rftopl 0    -- disable for all house codes. This is useful if more than
                   one CM15A is in use. Leaving both enabled will result in 
                   PL collisions and redundant commands.
</pre>
<a name="Multiple_controllers" id="Multiple_controllers"></a><h2> <span class="mw-headline"> Multiple controllers </span></h2>
<p>The Perl program mochamon.pl shows how to monitor more than one instance of
mochad. It is possible to create a master home automation master which talks to
more than one X10 controller. For example, a mocha master could receive RF
commands from controller A then send PL commands on controller B in a detached
building.
</p>
<a name="Command_line_X10_control" id="Command_line_X10_control"></a><h2> <span class="mw-headline"> Command line X10 control </span></h2>
<p>Command line control is useful for controlling devices from cron or CGI programs.
</p>
<pre>   $ echo "pl a all_lights_off" | nc localhost 1099
</pre>
<p>More generally, create a file name x10cmd with the following
</p>
<pre>   echo "$@" | nc localhost 1099
</pre>
<p>Make the file executable.
</p>
<pre>   $ chmod +x x10cmd
</pre>
<p>Run x10cmd with command line parameters to control X10 devices.
</p>
<pre>   $ ./x10cmd pl a all_lights_off
</pre>
<a name="Application_examples" id="Application_examples"></a><h2> <span class="mw-headline"> Application examples </span></h2>
<p>Simple applications in scripting languages.
</p><p><a href="simple_bash_application.html" title="Simple bash Application">Simple bash Application</a>
</p><p><a href="simple_perl_application.html" title="Simple Perl Application">Simple Perl Application</a>
</p>
<a name="Web_Interface" id="Web_Interface"></a><h2> <span class="mw-headline"> Web Interface </span></h2>
<p>The cgi/ sub-directory holds a simple Perl CGI web application that uses
mochad. The  interface is designed for small hand held devices over slow
connections (not broadband) so the web pages are very basic and small.
No GIFs or JPGs are used. To accomodate older devices with limited web browsers,
CSS, Javascript, or AJAX are not used. The web applications has buttons at
the top to send commands to mochad. The remainder shows status information
for X10 devices.
</p><p>Details on installing the cgi files are at <a href="Installing_CGI_Files" title="Installing CGI Files">Installing CGI Files</a>.
</p>
<a name="Hardware" id="Hardware"></a><h2> <span class="mw-headline"> Hardware </span></h2>
<p>X10 controllers: CM15A and CM19A
</p><p>Various X10 devices that have been tested with mochad:
</p>
<pre>   AM486, LM465 softstart, PAM02, RR501 (2 way), DS10A, MS10A, KR10A, SH624, KR19A
</pre>
<p>NOTE: CM15A macros and timers are not supported. For best results, use AHP
(ActiveHome Pro) to clear interface memory and disable the internal RF to PL
repeater. This ensures the CM15A behaves like a transceiver.
</p>
<a name="Files" id="Files"></a><h2> <span class="mw-headline"> Files </span></h2>
<pre>   *.c *.h     -- C source files
   mochamon.pl -- Perl program showing how to connect to three instance of 
                   mochad and dumping out the output to standard out.
   cgi/        -- Sample Perl CGI utilizing more than one mochad
</pre>
<a name="X10_Protocol" id="X10_Protocol"></a><h2> <span class="mw-headline"> X10 Protocol </span></h2>
<p>See <a href="x10_rf_security_extended_address.html" title="X10 RF Security Extended Address">X10 RF Security Extended Address</a> for details on extended RF security 
addresses.
</p>
<a name="Acknowledgments" id="Acknowledgments"></a><h2> <span class="mw-headline"> Acknowledgments </span></h2>
<p>The Perl CGI scripts uses the venerable cgi-lib.pl copyright Steven E. Brenner.
cgi-lib is simpler and smaller than CGI.pm which is appropriate for small
embedded systems such as WiFi routers. 
</p><p>For OpenWrt based systems, using LuCi would make more sense than Perl since
LuCi is already present in the system. However, the Perl CGI scripts work fine
with lighttpd on OpenWrt.
</p>
<a name="References" id="References"></a><h2> <span class="mw-headline"> References </span></h2>
<p>The following documents were useful in development of this program.
</p><p>X10 Power Line Protocol
</p>
<pre>   &lt;<a href="http://software.x10.com/pub/manuals/xtc798.doc" class="external free" title="http://software.x10.com/pub/manuals/xtc798.doc" rel="nofollow">http://software.x10.com/pub/manuals/xtc798.doc</a>&gt;
   &lt;<a href="http://software.x10.com/pub/manuals/xtc798.pdf" class="external free" title="http://software.x10.com/pub/manuals/xtc798.pdf" rel="nofollow">http://software.x10.com/pub/manuals/xtc798.pdf</a>&gt;
   &lt;<a href="http://software.x10.com/pub/manuals/xtdcode.pdf" class="external free" title="http://software.x10.com/pub/manuals/xtdcode.pdf" rel="nofollow">http://software.x10.com/pub/manuals/xtdcode.pdf</a>&gt;
</pre>
<p>X10 RF including RF Security Protocol
</p>
<pre>   &lt;<a href="http://www.edcheung.com/automa/rf.txt" class="external free" title="http://www.edcheung.com/automa/rf.txt" rel="nofollow">http://www.edcheung.com/automa/rf.txt</a>&gt;
</pre>
<p>X10 CM11A Protocol
</p>
<pre>   &lt;<a href="http://software.x10.com/pub/manuals/cm11a_protocol.txt" class="external free" title="http://software.x10.com/pub/manuals/cm11a_protocol.txt" rel="nofollow">http://software.x10.com/pub/manuals/cm11a_protocol.txt</a>&gt;
</pre>
<p>Linux Daemon HowTo
</p>
<pre>   &lt;<a href="http://www-theorie.physik.unizh.ch/~dpotter/howto/daemonize" class="external free" title="http://www-theorie.physik.unizh.ch/~dpotter/howto/daemonize" rel="nofollow">http://www-theorie.physik.unizh.ch/~dpotter/howto/daemonize</a>&gt;
</pre>
<!-- 
NewPP limit report
Preprocessor node count: 13/1000000
Post-expand include size: 0/2097152 bytes
Template argument size: 0/2097152 bytes
Expensive parser function count: 0/100
-->

<!-- Saved in parser cache with key p_mochad_mediawiki:pcache:idhash:1-0!1!0!!en!2!edit=0 and timestamp 20101228193514 -->
<div class="printfooter">
Retrieved from "<a href="Main_Page">http://sourceforge.net/apps/mediawiki/mochad/index.php?title=Main_Page</a>"</div>
						<!-- end content -->
						<div class="visualClear"></div>
		</div>
	</div>
		</div>
</body>
</html>